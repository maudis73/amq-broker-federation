apiVersion: broker.amq.io/v1beta1
kind: ActiveMQArtemis
metadata:
  name: broker-1
  annotations:
    argocd.argoproj.io/sync-wave: "20"
spec:
  acceptors:
    - expose: true
      name: ext-acceptor
      port: 61626
      protocols: AMQP,CORE
  brokerProperties:

    - addressConfigurations.test-multicast.routingTypes=MULTICAST

    - addressConfigurations.test-anycast.routingTypes=ANYCAST
    - addressConfigurations.test-anycast.queueConfigurations.test-anycast.routingType=ANYCAST

    - AMQPConnections.datacenter2.uri=tcp://broker-2-ext-acceptor-0-svc.{{ .Values.otherNamespace }}.svc.cluster.local:61626
    - AMQPConnections.datacenter2.connectionElements.mirror.type=MIRROR
    - AMQPConnections.datacenter2.connectionElements.mirror.sync=true

  console:
    expose: true
  deploymentPlan:
    resources:
      limits:
        cpu: "500m"    # 500 millicores = 0.5 CPU
        memory: "2Gi"  # Good practice: Always set a memory limit for Java!
      requests:
        cpu: "500m"    # Guaranteed CPU
        memory: "2Gi"
    storage:
      size: "2Gi"
    extraMounts:
      configMaps:
      - "newlog4j-logging-config"

    clustered: false
#    extraVolumeMounts:
#      - mountPath: /opt/amq-broker/data
#        name: extra-volume
#    extraVolumes:
#      - name: extra-volume
#        persistentVolumeClaim:
#          claimName: shared-volume
    persistenceEnabled: true
    requireLogin: false
    size: 1
